const DOCS_CONFIG = {
  'index': {
    title: 'Документация',
    hidden: true,
    content: `
      <div class="docs-welcome">
        <h1 class="docs-welcome__title">Добро пожаловать в документацию CodeSpark</h1>
        <p class="docs-welcome__description">
          Здесь вы найдете всю необходимую информацию о работе с платформой, правилах использования и политиках.
        </p>
        <div class="docs-welcome__card">
          <div class="docs-welcome__card-inner">
            <p class="docs-welcome__hint" style="margin-bottom: 0;">
              Выберите раздел документации в меню слева
            </p>
          </div>
        </div>
      </div>
    `
  },
  'privacy-policy': {
    title: 'Политика конфиденциальности',
    content: `
      <h1>Политика конфиденциальности</h1>

      <h2>1. Общие положения</h2>
      <p>Настоящая Политика конфиденциальности определяет порядок обработки и защиты персональных данных пользователей сервиса CodeSpark.</p>
      <p>Используя наш сервис, вы соглашаетесь с условиями данной политики.</p>

      <h2>2. Сбор информации</h2>
      <p>Мы собираем следующие типы информации:</p>
      <ul>
        <li>Личная информация (имя, email, контактные данные)</li>
        <li>Техническая информация (IP-адрес, тип браузера, операционная система)</li>
        <li>Информация об использовании сервиса</li>
      </ul>

      <h2>3. Использование информации</h2>
      <p>Собранная информация используется для:</p>
      <ul>
        <li>Предоставления и улучшения наших услуг</li>
        <li>Коммуникации с пользователями</li>
        <li>Обеспечения безопасности сервиса</li>
        <li>Анализа и оптимизации работы платформы</li>
      </ul>

      <h2>4. Защита данных</h2>
      <p>Мы применяем современные технологии и процедуры для защиты ваших персональных данных от несанкционированного доступа, изменения, раскрытия или уничтожения.</p>

      <h2>5. Права пользователей</h2>
      <p>Вы имеете право:</p>
      <ul>
        <li>Получать доступ к своим персональным данным</li>
        <li>Исправлять неточную информацию</li>
        <li>Удалять свои данные</li>
        <li>Ограничивать обработку данных</li>
      </ul>

      <h2>6. Изменения в политике</h2>
      <p>Мы оставляем за собой право вносить изменения в данную политику. Все изменения вступают в силу после публикации на сайте.</p>

      <h2>7. Контакты</h2>
      <p>По вопросам конфиденциальности обращайтесь: <a href="mailto:privacy@codespark.com">privacy@codespark.com</a></p>
    `
  },
  'user-guide': {
    title: 'Руководство пользователя',
    content: `
      <h1>Руководство пользователя CodeSpark</h1>

      <h2>1. Начало работы</h2>
      <p>Добро пожаловать в CodeSpark! Это руководство поможет вам начать работу с нашей платформой.</p>

      <h3>1.1 Регистрация</h3>
      <p>Для использования всех возможностей CodeSpark необходимо создать учетную запись:</p>
      <ul>
        <li>Нажмите кнопку "Регистрация" в правом верхнем углу</li>
        <li>Заполните форму регистрации</li>
        <li>Подтвердите email-адрес</li>
        <li>Войдите в систему</li>
      </ul>

      <h2>2. Основные функции</h2>

      <h3>2.1 Создание проекта</h3>
      <p>Чтобы создать новый проект:</p>
      <ol>
        <li>Перейдите в раздел "Проекты"</li>
        <li>Нажмите кнопку "Создать проект"</li>
        <li>Выберите шаблон или начните с пустого проекта</li>
        <li>Настройте параметры проекта</li>
      </ol>

      <h3>2.2 Редактор кода</h3>
      <p>Наш редактор предоставляет следующие возможности:</p>
      <ul>
        <li>Подсветка синтаксиса для множества языков</li>
        <li>Автодополнение кода</li>
        <li>Встроенная отладка</li>
        <li>Горячие клавиши для быстрой работы</li>
      </ul>

      <h2>3. Совместная работа</h2>
      <p>CodeSpark позволяет работать над проектами в команде:</p>
      <ul>
        <li>Приглашайте участников в проект</li>
        <li>Назначайте роли и права доступа</li>
        <li>Работайте одновременно над кодом</li>
        <li>Оставляйте комментарии и ведите обсуждения</li>
      </ul>

      <h2>4. Горячие клавиши</h2>
      <p><strong>Ctrl + S</strong> — Сохранить файл<br>
      <strong>Ctrl + F</strong> — Поиск<br>
      <strong>Ctrl + /</strong> — Закомментировать строку<br>
      <strong>Ctrl + Shift + F</strong> — Поиск по проекту</p>

      <h2>5. Поддержка</h2>
      <p>Если у вас возникли вопросы, обратитесь в службу поддержки через раздел "Помощь" или напишите нам на <a href="mailto:support@codespark.com">support@codespark.com</a></p>
    `
  },
  'licence-agreement': {
    title: 'Лицензионное соглашение',
    content: `
      <h1>Лицензионное соглашение</h1>

      <h2>1. Предмет соглашения</h2>
      <p>Настоящее Лицензионное соглашение (далее — «Соглашение») определяет условия использования программного обеспечения CodeSpark (далее — «ПО»).</p>

      <h2>2. Предоставление лицензии</h2>
      <p>Правообладатель предоставляет Пользователю неисключительную, непередаваемую лицензию на использование ПО в соответствии с условиями настоящего Соглашения.</p>

      <h3>2.1 Виды лицензий</h3>
      <ul>
        <li><strong>Бесплатная лицензия</strong> — ограниченный набор функций для личного использования</li>
        <li><strong>Профессиональная лицензия</strong> — полный набор функций для индивидуальных разработчиков</li>
        <li><strong>Корпоративная лицензия</strong> — расширенные возможности для команд и организаций</li>
      </ul>

      <h2>3. Права пользователя</h2>
      <p>Пользователь имеет право:</p>
      <ul>
        <li>Использовать ПО в соответствии с выбранным типом лицензии</li>
        <li>Создавать резервные копии</li>
        <li>Получать обновления и техническую поддержку</li>
      </ul>

      <h2>4. Ограничения</h2>
      <p>Пользователю запрещается:</p>
      <ul>
        <li>Копировать, модифицировать или распространять ПО без разрешения</li>
        <li>Проводить обратную разработку или декомпиляцию</li>
        <li>Сдавать ПО в аренду или предоставлять субподряд</li>
        <li>Использовать ПО для незаконных целей</li>
      </ul>

      <h2>5. Интеллектуальная собственность</h2>
      <p>Все права на ПО, включая авторские права, товарные знаки и другие права интеллектуальной собственности, принадлежат правообладателю.</p>

      <h2>6. Ответственность</h2>
      <p>ПО предоставляется «как есть». Правообладатель не несет ответственности за любые убытки, возникшие в результате использования или невозможности использования ПО.</p>

      <h2>7. Срок действия</h2>
      <p>Настоящее Соглашение вступает в силу с момента начала использования ПО и действует до момента его прекращения в соответствии с условиями Соглашения.</p>

      <h2>8. Изменения</h2>
      <p>Правообладатель оставляет за собой право вносить изменения в настоящее Соглашение. Продолжение использования ПО после внесения изменений означает согласие с новыми условиями.</p>
    `
  },
  'use-policy': {
    title: 'Политика использования',
    content: `
      <h1>Политика использования</h1>

      <h2>1. Общие правила</h2>
      <p>Используя сервис CodeSpark, вы соглашаетесь соблюдать следующие правила и условия.</p>

      <h2>2. Допустимое использование</h2>

      <h3>2.1 Разрешенные действия</h3>
      <ul>
        <li>Создание и разработка программных проектов</li>
        <li>Совместная работа над кодом с другими пользователями</li>
        <li>Использование образовательных ресурсов</li>
        <li>Публикация открытого кода с соответствующими лицензиями</li>
      </ul>

      <h3>2.2 Запрещенные действия</h3>
      <p>Строго запрещается использовать CodeSpark для:</p>
      <ul>
        <li>Создания вредоносного ПО (вирусы, трояны, эксплойты)</li>
        <li>Нарушения прав интеллектуальной собственности</li>
        <li>Распространения спама или нежелательного контента</li>
        <li>Атак на другие системы или сервисы</li>
        <li>Хранения или распространения незаконного контента</li>
        <li>Попыток несанкционированного доступа к системе</li>
      </ul>

      <h2>3. Контент пользователей</h2>

      <h3>3.1 Ответственность за контент</h3>
      <p>Вы несете полную ответственность за весь контент, который создаете, загружаете или публикуете через CodeSpark.</p>

      <h3>3.2 Права на контент</h3>
      <p>Вы сохраняете все права на свой код и проекты. Публикуя контент публично, вы предоставляете другим пользователям права в соответствии с выбранной вами лицензией.</p>

      <h2>4. Безопасность</h2>

      <h3>4.1 Защита учетной записи</h3>
      <ul>
        <li>Используйте надежные пароли</li>
        <li>Не передавайте данные для входа третьим лицам</li>
        <li>Немедленно сообщайте о подозрительной активности</li>
      </ul>

      <h3>4.2 Уязвимости</h3>
      <p>Если вы обнаружили уязвимость в системе, сообщите нам по адресу <a href="mailto:security@codespark.com">security@codespark.com</a></p>

      <h2>5. Ограничения использования</h2>

      <h3>5.1 Технические ограничения</h3>
      <ul>
        <li>Максимальный размер проекта зависит от типа подписки</li>
        <li>Ограничения на частоту запросов к API</li>
        <li>Лимиты на вычислительные ресурсы</li>
      </ul>

      <h2>6. Последствия нарушений</h2>
      <p>При нарушении политики использования мы можем:</p>
      <ul>
        <li>Выдать предупреждение</li>
        <li>Временно приостановить доступ</li>
        <li>Полностью заблокировать учетную запись</li>
        <li>Удалить нарушающий контент</li>
      </ul>

      <h2>7. Изменения политики</h2>
      <p>Мы оставляем за собой право изменять данную политику. Существенные изменения будут сообщены пользователям заранее.</p>
    `
  },
  'copyright': {
    title: 'Авторские права',
    content: `
      <h1>Авторские права</h1>

      <h2>1. Общая информация</h2>
      <p>CodeSpark уважает права интеллектуальной собственности и ожидает того же от своих пользователей.</p>

      <h2>2. Права на платформу</h2>
      <p>© 2024 CodeSpark. Все права защищены.</p>
      <p>CodeSpark, логотип CodeSpark и другие товарные знаки являются собственностью CodeSpark и защищены законами об авторском праве и товарных знаках.</p>

      <h3>2.1 Защищенные элементы</h3>
      <ul>
        <li>Исходный код платформы</li>
        <li>Дизайн и пользовательский интерфейс</li>
        <li>Логотипы и товарные знаки</li>
        <li>Документация и учебные материалы</li>
        <li>Графические элементы</li>
      </ul>

      <h2>3. Права на контент пользователей</h2>

      <h3>3.1 Ваши права</h3>
      <p>Вы сохраняете все права на код и контент, который создаете на платформе CodeSpark.</p>

      <h3>3.2 Лицензия для платформы</h3>
      <p>Загружая контент, вы предоставляете CodeSpark ограниченную лицензию на:</p>
      <ul>
        <li>Хранение и обработку вашего контента</li>
        <li>Отображение контента в соответствии с настройками приватности</li>
        <li>Создание резервных копий</li>
      </ul>

      <h2>4. Защита авторских прав</h2>

      <h3>4.1 Политика DMCA</h3>
      <p>CodeSpark соблюдает положения Digital Millennium Copyright Act (DMCA). Если вы считаете, что ваши авторские права нарушены, сообщите нам.</p>

      <h3>4.2 Подача жалобы</h3>
      <p>Жалоба на нарушение авторских прав должна включать:</p>
      <ul>
        <li>Подпись правообладателя или уполномоченного лица</li>
        <li>Описание защищенной работы</li>
        <li>Ссылку на материал, нарушающий права</li>
        <li>Контактную информацию</li>
        <li>Заявление о добросовестности</li>
      </ul>

      <p>Отправляйте жалобы на: <a href="mailto:copyright@codespark.com">copyright@codespark.com</a></p>

      <h2>5. Лицензии открытого кода</h2>

      <h3>5.1 Использование открытых лицензий</h3>
      <p>При публикации кода вы можете выбрать одну из следующих лицензий:</p>
      <ul>
        <li>MIT License</li>
        <li>Apache License 2.0</li>
        <li>GNU GPL v3</li>
        <li>BSD License</li>
        <li>Creative Commons</li>
      </ul>

      <h2>6. Использование чужого кода</h2>
      <p>При использовании кода других разработчиков:</p>
      <ul>
        <li>Соблюдайте условия лицензии</li>
        <li>Указывайте авторство</li>
        <li>Сохраняйте уведомления об авторских правах</li>
      </ul>

      <h2>7. Товарные знаки</h2>
      <p>Использование товарных знаков CodeSpark требует предварительного письменного разрешения. Запросы направляйте на: <a href="mailto:legal@codespark.com">legal@codespark.com</a></p>

      <h2>8. Контакты</h2>
      <p>По вопросам авторских прав:<br>
      Email: <a href="mailto:copyright@codespark.com">copyright@codespark.com</a><br>
      Юридический отдел: <a href="mailto:legal@codespark.com">legal@codespark.com</a></p>
    `
  },
  'about': {
    title: 'О нас',
    content: `
      <h1>О CodeSpark</h1>

      <h2>Наша миссия</h2>
      <p>CodeSpark создан для того, чтобы сделать процесс разработки программного обеспечения более доступным, эффективным и приятным для разработчиков по всему миру.</p>

      <h2>История</h2>
      <p>Проект CodeSpark был запущен в 2024 году группой энтузиастов, которые хотели создать инновационную платформу для совместной разработки. Мы стремимся объединить лучшие практики современной разработки с удобством использования и мощными инструментами.</p>

      <h2>Наши ценности</h2>

      <h3>Инновации</h3>
      <p>Мы постоянно внедряем новые технологии и подходы, чтобы предоставить разработчикам самые современные инструменты.</p>

      <h3>Сообщество</h3>
      <p>Мы верим в силу сообщества и поощряем обмен знаниями, открытый код и взаимопомощь между разработчиками.</p>

      <h3>Качество</h3>
      <p>Мы стремимся к высочайшему качеству во всем — от кода платформы до поддержки пользователей.</p>

      <h3>Доступность</h3>
      <p>Каждый должен иметь возможность учиться и создавать. Мы предоставляем бесплатный доступ к базовым функциям для всех пользователей.</p>

      <h2>Что мы предлагаем</h2>

      <h3>Мощный редактор кода</h3>
      <p>Современный редактор с подсветкой синтаксиса, автодополнением и встроенной отладкой для множества языков программирования.</p>

      <h3>Совместная работа</h3>
      <p>Работайте над проектами в команде в режиме реального времени, делитесь кодом и обменивайтесь идеями.</p>

      <h3>Облачная инфраструктура</h3>
      <p>Ваши проекты всегда доступны с любого устройства. Автоматическое сохранение и синхронизация обеспечивают безопасность ваших данных.</p>

      <h3>Обучающие ресурсы</h3>
      <p>Богатая база знаний, туториалы и примеры кода помогут вам освоить новые технологии и улучшить навыки.</p>

      <h2>Команда</h2>
      <p>CodeSpark разрабатывается международной командой опытных инженеров, дизайнеров и специалистов по продуктам, которые увлечены созданием лучших инструментов для разработчиков.</p>

      <h2>Технологии</h2>
      <p>Платформа построена на современном технологическом стеке:</p>
      <ul>
        <li>ASP.NET Core для backend</li>
        <li>React и современный JavaScript для frontend</li>
        <li>Docker для контейнеризации</li>
        <li>Kubernetes для оркестрации</li>
        <li>PostgreSQL для хранения данных</li>
      </ul>

      <h2>Присоединяйтесь к нам</h2>
      <p>Мы всегда рады новым талантливым людям! Если вы хотите стать частью команды CodeSpark, ознакомьтесь с открытыми вакансиями на нашем сайте.</p>

      <h2>Контакты</h2>
      <p>
        <strong>Email:</strong> <a href="mailto:info@codespark.com">info@codespark.com</a><br>
        <strong>Поддержка:</strong> <a href="mailto:support@codespark.com">support@codespark.com</a><br>
        <strong>Вакансии:</strong> <a href="mailto:careers@codespark.com">careers@codespark.com</a>
      </p>

      <h2>Социальные сети</h2>
      <p>Следите за новостями CodeSpark в социальных сетях и присоединяйтесь к нашему сообществу!</p>
    `
  }
};

class DocumentationController {
  constructor() {
    this.rootElement = document.querySelector('.docs[data-app="root"]');
    this.currentDoc = null;
    this.scrollButton = null;
    this.init();
  }

  init() {
    this.render();
    this.handleRouting();
    this.createScrollButton();
    this.setupScrollListener();
    window.addEventListener('popstate', () => this.handleRouting());
  }

  handleRouting() {
    const path = window.location.pathname;
    const match = path.match(/\/Documents\/Documentations\/(.+)/);

    if (match) {
      const docKey = match[1];
      if (DOCS_CONFIG[docKey]) {
        this.loadDocument(docKey);
      } else {
        this.showNotFound();
      }
    } else if (path === '/Documents/Documentations' || path === '/Documents/Documentations/') {
      this.loadDocument('index');
    } else {
      this.loadDocument('index');
    }
  }

  loadDocument(docKey) {
    if (this.currentDoc === docKey) return;

    this.currentDoc = docKey;
    const content = DOCS_CONFIG[docKey].content;

    document.querySelectorAll('.docs-nav__item').forEach(item => {
      item.classList.remove('active');
      if (item.dataset.doc === docKey) {
        item.classList.add('active');
      }
    });

    const contentElement = document.querySelector('.docs-content');
    contentElement.innerHTML = content;

    this.rootElement.scrollIntoView({ behavior: 'smooth', block: 'start' });

    const newUrl = `/Documents/Documentations/${docKey}`;
    if (window.location.pathname !== newUrl) {
      history.pushState(null, '', newUrl);
    }
  }

  showNotFound() {
    const contentElement = document.querySelector('.docs-content');
    contentElement.innerHTML = `
      <h1>Документ не найден</h1>
      <p>К сожалению, документ не существует.</p>
      <p><a href="/Documents/Documentations/index">Вернуться на главную</a></p>
    `;
  }

  createScrollButton() {
    this.scrollButton = document.createElement('button');
    this.scrollButton.className = 'scroll-to-top';
    this.scrollButton.innerHTML = `
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    `;
    this.scrollButton.setAttribute('aria-label', 'Прокрутить наверх');
    this.rootElement.appendChild(this.scrollButton);

    this.scrollButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
  }

  setupScrollListener() {
    let lastScroll = 0;

    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

      if (currentScroll > 300) {
        this.scrollButton.classList.add('visible');
      } else {
        this.scrollButton.classList.remove('visible');
      }

      lastScroll = currentScroll;
    });
  }

  render() {
    const navItems = Object.entries(DOCS_CONFIG)
      .filter(([key, doc]) => !doc.hidden)
      .map(([key, doc]) => {
        return `
          <li class="docs-nav__item" data-doc="${key}">
            <a href="/Documents/Documentations/${key}" class="docs-nav__link">
              ${doc.title}
            </a>
          </li>
        `;
      }).join('');

    this.rootElement.innerHTML = `
      <div class="docs-container">
        <nav class="docs-nav">
          <h2 class="docs-nav__title">Документация</h2>
          <ul class="docs-nav__list">
            ${navItems}
          </ul>
        </nav>
        <main class="docs-content"></main>
      </div>
    `;

    document.querySelectorAll('.docs-nav__link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const docKey = e.target.closest('.docs-nav__item').dataset.doc;
        this.loadDocument(docKey);
      });
    });
  }
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    new DocumentationController();
  });
} else {
  new DocumentationController();
}